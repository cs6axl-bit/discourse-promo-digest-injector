# config/settings.yml

plugins:
  # =========================
  # MASTER SWITCHES
  # =========================
  promo_digest_injector_enabled:
    default: true
    client: false

  # NEW: disables ONLY the "regular promo" injection block (superpromo/hardsale still run)
  promo_digest_injector_regular_enabled:
    default: true
    client: false

  # =========================
  # MIN-DIGESTS GATE
  # =========================
  promo_digest_injector_min_digests_before_inject:
    default: 0
    min: 0
    max: 999999
    client: false

  promo_digest_injector_digest_count_custom_field:
    default: "digest_sent_counter"
    client: false

  # =========================
  # REGULAR PROMO (tags + injection)
  # =========================
  promo_digest_injector_promo_tags:
    default: "promo"
    client: false

  promo_digest_injector_use_watched_categories:
    default: false
    client: false

  promo_digest_injector_include_watching_first_post:
    default: true
    client: false

  promo_digest_injector_min_position:
    default: 3
    min: 1
    max: 50
    client: false

  promo_digest_injector_coinflip_skip_percent:
    default: 0
    min: 0
    max: 100
    client: false

  promo_digest_injector_replace_within_top_n:
    default: 3
    min: 1
    max: 50
    client: false

  promo_digest_injector_replace_count:
    default: 1
    min: 1
    max: 50
    client: false

  promo_digest_injector_default_digest_limit:
    default: 50
    min: 1
    max: 200
    client: false

  promo_digest_injector_filter_promo_topics_created_after_last_digest:
    default: false
    client: false

  # "prefer_digest_list" or anything else (treated as "global_random" by your ruby)
  promo_digest_injector_promo_pick_mode:
    default: "prefer_digest_list"
    client: false

  promo_digest_injector_promo_candidate_scan_cap:
    default: 500
    min: 1
    max: 50000
    client: false

  # =========================
  # SUPERPROMO (independent pipeline)
  # =========================
  promo_digest_injector_superpromo_enabled:
    default: false
    client: false

  promo_digest_injector_superpromo_tags:
    default: "superpromo"
    client: false

  promo_digest_injector_superpromo_use_watched_categories:
    default: false
    client: false

  promo_digest_injector_superpromo_include_watching_first_post:
    default: true
    client: false

  promo_digest_injector_superpromo_min_position:
    default: 3
    min: 1
    max: 50
    client: false

  promo_digest_injector_superpromo_coinflip_skip_percent:
    default: 0
    min: 0
    max: 100
    client: false

  promo_digest_injector_superpromo_replace_within_top_n:
    default: 3
    min: 1
    max: 50
    client: false

  promo_digest_injector_superpromo_replace_count:
    default: 1
    min: 1
    max: 50
    client: false

  promo_digest_injector_superpromo_filter_topics_created_after_last_digest:
    default: false
    client: false

  promo_digest_injector_superpromo_pick_mode:
    default: "prefer_digest_list"
    client: false

  promo_digest_injector_superpromo_candidate_scan_cap:
    default: 500
    min: 1
    max: 50000
    client: false

  # =========================
  # HARDSALE PROMOS (NEW independent pipeline)
  # =========================
  promo_digest_injector_hardsale_enabled:
    default: false
    client: false

  promo_digest_injector_hardsale_tags:
    default: "hardsale"
    client: false

  promo_digest_injector_hardsale_use_watched_categories:
    default: false
    client: false

  promo_digest_injector_hardsale_include_watching_first_post:
    default: true
    client: false

  promo_digest_injector_hardsale_min_position:
    default: 3
    min: 1
    max: 50
    client: false

  promo_digest_injector_hardsale_coinflip_skip_percent:
    default: 0
    min: 0
    max: 100
    client: false

  promo_digest_injector_hardsale_replace_within_top_n:
    default: 3
    min: 1
    max: 50
    client: false

  promo_digest_injector_hardsale_replace_count:
    default: 1
    min: 1
    max: 50
    client: false

  promo_digest_injector_hardsale_filter_topics_created_after_last_digest:
    default: false
    client: false

  promo_digest_injector_hardsale_pick_mode:
    default: "prefer_digest_list"
    client: false

  promo_digest_injector_hardsale_candidate_scan_cap:
    default: 500
    min: 1
    max: 50000
    client: false

  # =========================
  # WATCHED-CATEGORY PERCENT ENFORCER
  # =========================
  promo_digest_injector_enforce_min_watched_category_percent:
    default: false
    client: false

  promo_digest_injector_min_watched_category_percent:
    default: 0
    min: 0
    max: 100
    client: false

  promo_digest_injector_watched_enforce_lookahead_extra:
    default: 0
    min: 0
    max: 500
    client: false

  promo_digest_injector_watched_enforce_forum_scan_cap:
    default: 500
    min: 1
    max: 50000
    client: false

  # =========================
  # FORCE FIRST TOPIC FROM WATCHED CATEGORY
  # =========================
  promo_digest_injector_force_first_topic_from_watched_category:
    default: false
    client: false

  promo_digest_injector_force_first_topic_watched_coinflip_percent:
    default: 100
    min: 0
    max: 100
    client: false

  promo_digest_injector_force_first_topic_randomize_even_if_already_watched:
    default: false
    client: false

  promo_digest_injector_force_first_topic_random_top_n:
    default: 5
    min: 1
    max: 100
    client: false

  promo_digest_injector_force_first_topic_require_created_after_last_digest:
    default: false
    client: false

  promo_digest_injector_force_first_topic_soft_fallback:
    default: true
    client: false

  promo_digest_injector_force_first_topic_lookahead:
    default: 50
    min: 1
    max: 500
    client: false

  # =========================
  # SHUFFLE TOPICS IF USER HAS NO WATCHED CATEGORIES
  # =========================
  promo_digest_injector_shuffle_topics_if_no_watched_categories:
    default: false
    client: false

  promo_digest_injector_shuffle_topics_if_no_watched_top_n:
    default: 4
    min: 2
    max: 50
    client: false

  promo_digest_injector_shuffle_topics_if_no_watched_coinflip_percent:
    default: 0
    min: 0
    max: 100
    client: false

  # =========================
  # PERSIST “LAST DIGEST TOPICS” FIELDS
  # =========================
  promo_digest_injector_last_digest_topics_field:
    default: "promo_digest_last50_topic_ids"
    client: false

  promo_digest_injector_last_digest_topics_max:
    default: 50
    min: 1
    max: 500
    client: false

  promo_digest_injector_last_digest_first_topics_field:
    default: "promo_digest_last10_first_topic_ids"
    client: false

  promo_digest_injector_last_digest_first_topics_max:
    default: 10
    min: 1
    max: 100
    client: false

  # =========================
  # REPORT POSTBACK (PHP endpoint)
  # =========================
  promo_digest_injector_endpoint_url:
    default: ""
    client: false

  promo_digest_injector_secret_header_value:
    default: ""
    client: false

  promo_digest_injector_log_post_results:
    default: true
    client: false

  promo_digest_injector_http_open_timeout:
    default: 3
    min: 1
    max: 60
    client: false

  promo_digest_injector_http_read_timeout:
    default: 5
    min: 1
    max: 120
    client: false

  promo_digest_injector_send_ids_only:
    default: true
    client: false

  # =========================
  # DEBUG
  # =========================
  promo_digest_injector_debug_callsite_depth:
    default: 10
    min: 1
    max: 50
    client: false

  promo_digest_injector_debug_include_opts:
    default: true
    client: false

  promo_digest_injector_push_specific_enabled:
    default: false
    client: false

  promo_digest_injector_push_specific_topic_id:
    default: 0
    client: false
    type: integer    

  promo_digest_injector_regular_enabled:
    default: true
    client: false
    type: bool

  # --- PUSH override: coinflip gating (0..100) ---
  promo_digest_injector_push_specific_apply_percent:
    default: 100
    client: false
    type: integer
    min: 0
    max: 100

  # --- PUSH override: dynamic picker (Stage A1/A2/B) ---
  promo_digest_injector_push_specific_dynamic_enabled:
    default: false
    client: false
    type: bool

  # Pipe-separated tag names, eg: "verified|featured"
  promo_digest_injector_push_specific_dynamic_tags:
    default: "verified"
    client: false
    type: string

  promo_digest_injector_push_specific_dynamic_require_created_after_last_digest:
    default: false
    client: false
    type: bool

  # Stage A2: how many extra digest candidates beyond the normal limit to consider
  promo_digest_injector_push_specific_dynamic_lookahead_extra:
    default: 50
    client: false
    type: integer
    min: 0

  # Stage B: forum-wide fallback scan cap
  promo_digest_injector_push_specific_dynamic_forum_scan_cap:
    default: 500
    client: false
    type: integer
    min: 1

  # --- PUSH override: exclude topics that were "pushed" recently (per-user history) ---
  promo_digest_injector_push_specific_exclude_recent_pushed:
    default: true
    client: false
    type: bool

  promo_digest_injector_push_specific_exclude_recent_pushed_days:
    default: 30
    client: false
    type: integer
    min: 0

  # Where we store push history in user custom_fields (JSON array)
  promo_digest_injector_push_specific_pushed_history_field:
    default: "promo_digest_pushed_topics_last50"
    client: false
    type: string

  promo_digest_injector_push_specific_pushed_history_max:
    default: 50
    client: false
    type: integer
    min: 1

